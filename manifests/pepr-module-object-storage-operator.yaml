apiVersion: v1
kind: Namespace
metadata:
  name: pepr-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: pepr-object-storage-operator
rules:
  - apiGroups:
      - '*'
    resources:
      - '*'
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: pepr-object-storage-operator
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: pepr-object-storage-operator
subjects:
  - kind: ServiceAccount
    name: pepr-object-storage-operator
    namespace: pepr-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: pepr-object-storage-operator
  namespace: pepr-system
---
apiVersion: v1
kind: Secret
metadata:
  name: pepr-object-storage-operator-api-token
  namespace: pepr-system
type: Opaque
data:
  value: >-
    M2IxODFiMzkyMDEwOWYwYmI1NjdjNGU4ZWIyYTk0MzA2ZmZmOTY0YzA3ZDkxZGM3Mjc1MDgyNTExOWIzOGQ4NA==
---
apiVersion: v1
kind: Secret
metadata:
  name: pepr-object-storage-operator-tls
  namespace: pepr-system
type: kubernetes.io/tls
data:
  tls.crt: >-
    LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tDQpNSUlDdGpDQ0FaNmdBd0lCQWdJQkFUQU5CZ2txaGtpRzl3MEJBUXNGQURBQU1CNFhEVEkwTURFeU5USXhNVEEwDQpNMW9YRFRJMU1ERXlOVEl4TVRBME0xb3dBRENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DDQpnZ0VCQUwyZnhkSVlLWGNUSWFaTUJhbjBQdWs2a0NXczJqeDUzbDg4Ym5CQUdzZi9oWmFJSEFmT0o2QitNdWloDQpEdm9lZXVKME9JMmI3cGk4UHVLLzZLeUQvRlZHVWh0eWx0UEZHeWxjSVpwK0dYZzhYREIxV2tpNXdoTVYzc2FGDQo2ak9QZ0JMSEFLZHdCMjNhdGE4R25lNGNJeEl5aGsxVG1jdUpkai96YjFBVHJpVVJocWZYVFlKOUFHdEpWdWdEDQphWERtZWV6NE94MEZVcjJ1TzhGM216OTg0UlViY09oMElJRmQ0dnFaUnUyY1FoTUIrSTVNeUVtczJ0S3BaZjV5DQp6Zi9CSHFjSFRCRXJDWkJ0Q1M0WFJlbW5tQzk2c1dyK09Td2xBR3JhMHlRTlNUdjBoTmFBeVhTTXVmRjJFbmtRDQpMbVE3cnJQbHJXUWdpWWhRWnZOR09pV3pzTXNDQXdFQUFhTTdNRGt3TndZRFZSMFJCREF3TG9Jc2NHVndjaTF2DQpZbXBsWTNRdGMzUnZjbUZuWlMxdmNHVnlZWFJ2Y2k1d1pYQnlMWE41YzNSbGJTNXpkbU13RFFZSktvWklodmNODQpBUUVMQlFBRGdnRUJBR1E3QzB4RDdVSndJT3EzR3drSHhxVFJ1WVFhOTd5cXVLbko2M0VYanZyMklhNjZ3Vlk1DQo3ZGVOaUNWY0ZEeDExUVNIYWVJWEdMd0lGb3ljN2pGbm9iL0JsQld3WHZFN0hrNGVlcnhYM3dTc0s1VnFsVzNGDQpTNHhjcVdrK3l3UFByNldNNWpJbG1TZ0kyNHNTMEVZKzBjZ3lzdE5QU3ZndmwvNC84YnpreUI0eE9UL0xUZUlIDQo1QkJCdjhFMGxrZXJQWk9RcEhTL0trcVgvaGJrVy95U0N6VFJ1c1hMdmNRQng2bzlIZGRrSUdkdXF2Z0lkaFFCDQpvalJKRC9uOXdDcG81NTVQUVhXVXhjeXB1blRTai9wQ21tKzd4ZXRpUXNEWGEzVGlkTm5uSWRab1JUd3l5SnhrDQp0TEVQaTdQU2FNaFVCWkRNMWdYM1Q3WkZSN1ExTmVQWVF6UT0NCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0NCg==
  tls.key: >-
    LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQ0KTUlJRW93SUJBQUtDQVFFQXZaL0YwaGdwZHhNaHBrd0ZxZlErNlRxUUphemFQSG5lWHp4dWNFQWF4LytGbG9nYw0KQjg0bm9INHk2S0VPK2g1NjRuUTRqWnZ1bUx3KzRyL29ySVA4VlVaU0czS1cwOFViS1Z3aG1uNFplRHhjTUhWYQ0KU0xuQ0V4WGV4b1hxTTQrQUVzY0FwM0FIYmRxMXJ3YWQ3aHdqRWpLR1RWT1p5NGwyUC9OdlVCT3VKUkdHcDlkTg0KZ24wQWEwbFc2QU5wY09aNTdQZzdIUVZTdmE0N3dYZWJQM3poRlJ0dzZIUWdnVjNpK3BsRzdaeENFd0g0amt6SQ0KU2F6YTBxbGwvbkxOLzhFZXB3ZE1FU3NKa0cwSkxoZEY2YWVZTDNxeGF2NDVMQ1VBYXRyVEpBMUpPL1NFMW9ESg0KZEl5NThYWVNlUkF1WkR1dXMrV3RaQ0NKaUZCbTgwWTZKYk93eXdJREFRQUJBb0lCQUF6bTBRUFJad2pXQVdVYQ0KS1F4K05NV1RtWGttd0paNnlEbDhtQnNGRVkxb0FrUFNzTzJMQmtFeU5PNkUvc3JmeGdhZ1Y3U3kxbElJQk5OUw0Kc1ZjRGgraVpaejY4MWl4RWJldXJmQkhSNEpQQXI1a1FjdnNkd0dtaUJFMUhrVDYrMWJ6eFUwY1JKVUJCTURsZg0KWHVGemdxTmJVcTN5TVRXYS9iT3VNWFdtVVNQdVppVEdFK0Vxd2syeENrNUVuRCtpSmkrRkxCTUNBTi9pZWdURA0KYW9nWVhhem15N2s1NEpqSEl0VDkyME9Td3lsbmpCbG1Lcy9MUTBNS0JaYnpHK1ZJa01tK2w3VUxJRWpRdVBoag0KMGRMQ2owVFl4Sjc0bWV2RjRhMTJyMU55bFExNzYwRlYzM1haSWdJZU1iN0lQclUza2FaTFVjbHRKT1NWS011TA0KZnhQb1hna0NnWUVBK0EwVEJ3a2pCc0dpUVJtVURmM3ZFM29XWmllTUVoUm03Q1k0NkhYcVhHbnR0elFxYmtzYg0KUEh4N08vUnlXaXBIUGRJTnFFWG9HK29Za0ltOGlDeEJvK1AreHZPTWQrMm8wVm9PL2RMcE11RDBoaEhUemxCKw0KVkJ6YWNJRjc4akV0ZmptcDZwVHJYblRLQUZtdTlGSjhCWEJFamJSY3psZTdFcmxrM2FYeG1EOENnWUVBdzdOaQ0KUEV4Tnh1SjRoak9LMC9GZFg4N1Y2ZGkwcmtSaXM3Z1pJazg3dVhqcWhIdHFYNnhmUTVDQnoybVRLRUlpOWU0Zg0KVG9WSkluR0kwVVEzV0FEVHN1U1k4VXorYlpXZVpWbDRSN1lLUER2Yzh3ckpIRDFSOXV1aVRKVExUQ0ZJMldveA0KMHFrcmNRQ0pMQkw2dCtQTm5yVk9qNG9wNS95Zldyc0tZQWtQNUhVQ2dZRUEzaTVuMHE5K2Jqalc2dFRNWnRRRA0KWjBDOSszYUU0bFRmODdvdzB4ZDdlcGR2VStBbitXN1EwSmIza3paYmp5TzdlRVpEOFd2Y2dkUm5lRi9IUFhuVw0KdWNRb20yL2ZiRFMyTi84ZzJuNG1YMnBiM0JMdjB5Y0tZTEVQZ0NLYk1NNlgzeTRyWW5GTmVlZkdZQlgwdmVkOA0KS3lycVhMc25QYlFiWHFRdEV0UG0yT1VDZ1lBd01KbitFeVFMMTNTcVIwTG1VY2NXY281R1dUQ1V3UTQxQng1Wg0KVG4xOGZJUHpQNWpBR21nUzhTQ2wvRzlhT0g3M1pEMmRUa0RtRkdNR2RPL1Q0ZEEvZXY4V1hFbENudGMwU2NYTw0Ka3NzT2JnZElhZDEvOExHZ1JnSGZMYnlwOElCSjJWYVBjMHpaTkxLU2dkSHZPazlGeDR1aTJQamN3VjVVTHo2cw0KeTA1NGlRS0JnRHVOMFNVd203Q1ZyVk9tU1RSbU8xdG0wWE9CRG9BYmp5c3FjNXBOTXpJNzNYaGNZeDVFUjZtdA0KeUIxbHA0Vk9relZOYlpQMmhBRWlBL2Y0VjRrWVR6ZnM2dDNIVGVSRm9ZT2NFQ2toZzhtZDhLR3hqZmZUaHEwYg0KUVlSd1VpNWxoRUhmMFlaM2IyQXN2ZUhaZk5JcnY0TjRMOE41NlMzR0Y2RjQ4bllqYXd5aw0KLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0NCg==
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pepr-object-storage-operator
  namespace: pepr-system
  labels:
    app: pepr-object-storage-operator
    pepr.dev/controller: admission
spec:
  replicas: 2
  selector:
    matchLabels:
      app: pepr-object-storage-operator
      pepr.dev/controller: admission
  template:
    metadata:
      annotations:
        buildTimestamp: '1706217043886'
      labels:
        app: pepr-object-storage-operator
        pepr.dev/controller: admission
    spec:
      priorityClassName: system-node-critical
      serviceAccountName: pepr-object-storage-operator
      securityContext:
        runAsUser: 65532
        runAsGroup: 65532
        runAsNonRoot: true
        fsGroup: 65532
      containers:
        - name: server
          image: ghcr.io/defenseunicorns/pepr/controller:v0.23.1
          imagePullPolicy: IfNotPresent
          command:
            - node
            - /app/node_modules/pepr/dist/controller.js
            - e91c89ef67584a9233420846fd5570bcba397229dbe8a61d3536bb346c4bd86d
          readinessProbe:
            httpGet:
              path: /healthz
              port: 3000
              scheme: HTTPS
          livenessProbe:
            httpGet:
              path: /healthz
              port: 3000
              scheme: HTTPS
          ports:
            - containerPort: 3000
          resources:
            requests:
              memory: 64Mi
              cpu: 100m
            limits:
              memory: 256Mi
              cpu: 500m
          env:
            - name: PEPR_WATCH_MODE
              value: 'false'
            - name: PEPR_PRETTY_LOG
              value: 'false'
            - name: LOG_LEVEL
              value: debug
          securityContext:
            runAsUser: 65532
            runAsGroup: 65532
            runAsNonRoot: true
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                - ALL
          volumeMounts:
            - name: tls-certs
              mountPath: /etc/certs
              readOnly: true
            - name: api-token
              mountPath: /app/api-token
              readOnly: true
            - name: module
              mountPath: /app/load
              readOnly: true
      volumes:
        - name: tls-certs
          secret:
            secretName: pepr-object-storage-operator-tls
        - name: api-token
          secret:
            secretName: pepr-object-storage-operator-api-token
        - name: module
          secret:
            secretName: pepr-object-storage-operator-module
---
apiVersion: v1
kind: Service
metadata:
  name: pepr-object-storage-operator
  namespace: pepr-system
  labels:
    pepr.dev/controller: admission
spec:
  selector:
    app: pepr-object-storage-operator
    pepr.dev/controller: admission
  ports:
    - port: 443
      targetPort: 3000
---
apiVersion: v1
kind: Service
metadata:
  name: pepr-object-storage-operator-watcher
  namespace: pepr-system
  labels:
    pepr.dev/controller: watcher
spec:
  selector:
    app: pepr-object-storage-operator-watcher
    pepr.dev/controller: watcher
  ports:
    - port: 443
      targetPort: 3000
---
apiVersion: v1
kind: Secret
metadata:
  name: pepr-object-storage-operator-module
  namespace: pepr-system
type: Opaque
data:
  module-e91c89ef67584a9233420846fd5570bcba397229dbe8a61d3536bb346c4bd86d.js.gz: >-
    H4sIAAAAAAAAE61UUW/cNgx+76/QtKGxAVm57DCg8MHFtm4rgi5L0SHoQxCgOonnqNFJGildahj+74PsS5di7fqyN1Ef+ZEiP+qgkPXd5fY96CQN7KyH1xgiYBo2B4UsdFUSWHfP+yoJ7tUeuBgPymVoUejgd7bPqLYO2m9WUz2H2A7hr2wRKh4hIl9uYzeW6JaHOVdDKaDqoSm5VArIxQGQbPAtX8mVPOPCAGm0Mc13P7FXeQvoIQGxy2MM2wVke+VVb33PFmJ2JGbbrO8gkeTiDob7gIba66Ugwe+eERc8Bmf10IDvrYdiQ8RmH0x2xSLQGW0a+I1YPKgdfTDQ8ufd2TO5kis+iRLSfu1hOVvzH3DwvyIGbDlC8eBCuXs10HnvA8JCTlFpoPb6Rji1BVdOk7Beu2zA/GbdgoE/tOM0iaVt1I7bbJ1puY8fWCmUzTZ7+pTpyIyldProxc0X6pOD2rvSZLsDSnRaurc2DUHKkbflzLTLlACZAQcJ5lSNgUNJ9BjWCOox3DR3a2oU9uykaQxsc/8jAR4A29UJa5p7ZdNMkbegk2MYnAu5zFelTMxAdGHYg0+s8bNTQwMl2PNJGIjgDXhty9DmGfGV/H4tz2bw8MsneBriUWkt/0Gu5ZpP0yxZ9Vkh68/eQqedImLwIYE3xLRU8iV4QKtfWW/GUrXVY6jSrSXB/1z/PMuT1xNF0Es+Wjj+7cvrSdHg9bGFS2iF9Wh3FTLrKSmvIewY1KODxPYdykIri3aEebAQehv8RgdPwYF0oa/evSiMZXuWdWEn34376YRZzxbvcmGmk3f1BI6ApVsM98zDPZs1W/ErTznGgAkMo4QqQT+w0lHJLjIllgnYw2M/OkheH1vsu8Kl5AsV1dY6m4bqa9v0v30LjxeLH2F+M9VifHsLvnVT5zfVSij5BnpbFFwGWVcgxh5Dji03im6NGkgaODz6vg5nXNxZb9p/pjzVG1dBLc9p7jeYS7yKphyqWp77Px4qqT7WUcu3Kunbap57VXfPRzUvRGkXVbX8RAlQT/WmIFa+hogX80JXUVz7m3rz5PT0W0Yho4YLFaP1/dWb37t5C7+08u9J7lV88jfRe1WSHAYAAA==
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: peprstores.pepr.dev
spec:
  group: pepr.dev
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            data:
              type: object
              additionalProperties:
                type: string
  scope: Namespaced
  names:
    plural: peprstores
    singular: peprstore
    kind: PeprStore
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: pepr-object-storage-operator-store
  namespace: pepr-system
rules:
  - apiGroups:
      - pepr.dev
    resources:
      - peprstores
    resourceNames:
      - ''
    verbs:
      - create
      - get
      - patch
      - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: pepr-object-storage-operator-store
  namespace: pepr-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: pepr-object-storage-operator-store
subjects:
  - kind: ServiceAccount
    name: pepr-object-storage-operator-store
    namespace: pepr-system
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pepr-object-storage-operator-watcher
  namespace: pepr-system
  labels:
    app: pepr-object-storage-operator-watcher
    pepr.dev/controller: watcher
spec:
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: pepr-object-storage-operator-watcher
      pepr.dev/controller: watcher
  template:
    metadata:
      annotations:
        buildTimestamp: '1706217043886'
      labels:
        app: pepr-object-storage-operator-watcher
        pepr.dev/controller: watcher
    spec:
      serviceAccountName: pepr-object-storage-operator
      securityContext:
        runAsUser: 65532
        runAsGroup: 65532
        runAsNonRoot: true
        fsGroup: 65532
      containers:
        - name: watcher
          image: ghcr.io/defenseunicorns/pepr/controller:v0.23.1
          imagePullPolicy: IfNotPresent
          command:
            - node
            - /app/node_modules/pepr/dist/controller.js
            - e91c89ef67584a9233420846fd5570bcba397229dbe8a61d3536bb346c4bd86d
          readinessProbe:
            httpGet:
              path: /healthz
              port: 3000
              scheme: HTTPS
          livenessProbe:
            httpGet:
              path: /healthz
              port: 3000
              scheme: HTTPS
          ports:
            - containerPort: 3000
          resources:
            requests:
              memory: 64Mi
              cpu: 100m
            limits:
              memory: 256Mi
              cpu: 500m
          securityContext:
            runAsUser: 65532
            runAsGroup: 65532
            runAsNonRoot: true
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                - ALL
          volumeMounts:
            - name: tls-certs
              mountPath: /etc/certs
              readOnly: true
            - name: module
              mountPath: /app/load
              readOnly: true
          env:
            - name: PEPR_WATCH_MODE
              value: 'true'
            - name: PEPR_PRETTY_LOG
              value: 'false'
            - name: LOG_LEVEL
              value: debug
      volumes:
        - name: tls-certs
          secret:
            secretName: pepr-object-storage-operator-tls
        - name: module
          secret:
            secretName: pepr-object-storage-operator-module
